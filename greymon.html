<!DOCTYPE html>
<html>
<head>
  <title>CRINGE</title>
  <style>
    body {
      background-color: black;
      color: white;
      text-align: center;
      font-family: Arial, sans-serif;
    }
    img {
      max-width: 90%;
      max-height: 70%;
      bottom: 0;
      left: 0;
      margin: auto;
      overflow: auto;
      position: fixed;
      right: 0;
      top: 0;
      object-fit: contain;
    }
  </style>
</head>
<body>
  <h1>WELCOME TO GREYMON NIGHT</h1>
  <img id="protected-image" alt="Protected image">

  <!-- ADDED: audio file -->
  <audio id="reveal-sound" src="sound.mp3"></audio>

  <script>
    async function loadImage() {
      const password = sessionStorage.getItem("videoPassword");

      // If no password, send them back to index.html
      if (!password) {
        window.location.replace("index.html");
        return;
      }

      const imageRes = await fetch(`/.netlify/functions/getImage?password=${encodeURIComponent(password)}`);

      if (imageRes.ok) {
        const imageBlob = await imageRes.blob();
        const imgElem = document.getElementById("protected-image");
        imgElem.src = URL.createObjectURL(imageBlob);

        // ADDED: when the image loads, play sound after 3 seconds
        imgElem.onload = () => {
          setTimeout(() => {
            const sound = document.getElementById("reveal-sound");

            sound.play().catch(() => {
              // If the browser blocks autoplay
              console.log("Sound blocked; user interaction needed.");
            });
          }, 3000);
        };

      } else {
        // If wrong password or expired session, send them back silently
        window.location.replace("index.html");
      }
    }

    loadImage();
  </script>
</body>
</html>
